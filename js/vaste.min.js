NProgress.configure({showSpinner:false});toastr.options={positionClass:"toast-top-center",timeOut:"1000",preventDuplicates:true,showMethod:"slideDown",hideMethod:"fadeOut"};var vaste=new Vue({el:"#text",data:{text:"",shortId:location.href.split("/",4)[3],texts:[]},mounted:function(){this.$nextTick(function(){this.findByShortID()});this.getTexts()},computed:{processedTexts:function(){if(this.texts.length!==0){return this.texts.filter(function(b){b.updatetime=moment(b.updatetime).startOf("hour").fromNow();if(b.text!==null){b.text=b.text.slice(0,40)}return b})}else{return null}}},methods:{add:function(){var a=this;$.ajax({type:"post",url:"/shortids",beforeSend:function(){NProgress.start()},success:function(b){if(b!==null){window.location.href="/"+b}else{console.log(b)}},error:function(b){toastr.error("获取内容失败！");console.log(b)},complete:function(){NProgress.done()}})},clickSave:function(){var a=this;$.ajax({type:"get",url:"/texts/"+a.shortId,beforeSend:function(){NProgress.start()},success:function(b){if(b!==null&&b!==""){a.update()}else{a.save()}},error:function(b){toastr.error("保存失败！");console.log(b)},complete:function(){NProgress.done()}})},update:function(){var a=this;$.ajax({type:"patch",url:"/texts/"+a.shortId,data:{text:a.text},beforeSend:function(){NProgress.start()},success:function(b){if(b!==null){toastr.success("更新成功！")}},error:function(b){toastr.error("更新失败！");console.log(b)},complete:function(){NProgress.done()}})},save:function(){var a=this;$.ajax({type:"post",url:"/texts",data:{text:a.text,shortId:a.shortId},beforeSend:function(){NProgress.start()},success:function(b){if(b!==null){toastr.success("保存成功！")}},error:function(b){toastr.error("保存失败！");console.log(b)},complete:function(){NProgress.done()}})},findByShortID:function(){var a=this;if(/\d{1,4}/i.test(a.shortId)){$.ajax({type:"get",url:"/texts/"+a.shortId,beforeSend:function(){NProgress.start()},success:function(b){if(b!==null){a.text=b.text}else{console.log(b)}},error:function(b){toastr.error("获取内容失败！");console.log(b)},complete:function(){NProgress.done()}})}},getTexts:function(){var a=this;$.ajax({type:"get",url:"/texts",beforeSend:function(){NProgress.start()},success:function(b){if(b!==null&&b!==""){a.texts=b}else{console.log(b)}},error:function(b){toastr.error("获取内容失败！");console.log(b)},complete:function(){NProgress.done()}})},deleteText:function(){var a=this;window.location.href="/vastelist.html";$.ajax({type:"DELETE",url:"/texts/"+a.shortId,beforeSend:function(){NProgress.start()},success:function(b){if(typeof b==="number"){if(b===0){toastr.warning("该记录不能存在！")}}else{console.log(b)}},error:function(b){toastr.error("获取内容失败！");console.log(b)},complete:function(){NProgress.done()}})}}});